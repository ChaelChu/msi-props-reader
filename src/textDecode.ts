import { Logger } from "./logger";

const UTF8_CODE_PAGES = [65001];
const LATIN_BYTE_CODE_PAGES = [0, 437, 708, 720, 737, 775, 850, 852, 855, 857, 858, 860, 861, 862, 863, 
    864, 865, 866, 869, 874, 932, 936, 949, 950, 1250, 1251, 1252, 1253, 1254, 1255, 1256, 1257, 1258, 
    10000, 10001, 10002, 10003, 10004, 10005, 10006, 10007, 10008, 10010, 10017, 10021, 10029, 10079, 
    10081, 10082, 20000, 20001, 20002, 20003, 20004, 20005, 20105, 20127, 20269, 20866, 20932, 20936, 
    20949, 21866, 28591, 28592, 28593, 28594, 28595, 28596, 28597, 28598, 28599, 28603, 28605, 38598, 
    50220, 50221, 50222, 50225, 50227, 50229, 51949, 52936, 54936, 57002, 57003, 57004, 57005, 57006, 
    57007, 57008, 57009, 57010, 57011];

const CONVERTABLE_TO_LATIN_BYTE_CODE_PAGES = [37, 500, 870, 875, 1026, 1047, 1140, 1141, 1142, 1143, 1144, 1145, 1146, 1147, 1148, 
    1149, 20273, 20277, 20278, 20280, 20284, 20285, 20290, 20297, 20424, 20833, 20838, 20871, 20880, 
    20905, 20924, 21025, 21027];

const CHAR_MAP_0 = ['\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', " ", 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', ".", '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "-", '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "a", "b", "c", "d", "e", 
    "f", "g", "h", "i", '\0', '\0', '\0', '\0', '\0', '\0', '\0', "j", "k", "l", "m", "n", "o", "p", "q", "r", 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "s", "t", "u", "v", "w", "x", "y", "z", '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', "{", "A", "B", "C", "D", "E", "F", "G", "H", "I", '\0', '\0', '\0', '\0', '\0', '\0', "}", "J", "K", 
    "L", "M", "N", "O", "P", "Q", "R", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "S", "T", "U", "V", 
    "W", "X", "Y", "Z", '\0', '\0', '\0', '\0', '\0', '\0', "0", "1", "2", "3", "4", "5", "6", "7", "8", 
    "9", '\0', '\0', '\0', '\0', '\0', '\0'];

const CHAR_MAP_1 = ['\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', " ", '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', "{", '\0', '\0', ".", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "-", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', "a", "b", "c", "d", "e", "f", "g", "h", "i", '\0', '\0', "}", '\0', '\0', 
    '\0', '\0', "j", "k", "l", "m", "n", "o", "p", "q", "r", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "s", 
    "t", "u", "v", "w", "x", "y", "z", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "A", "B", "C", "D", "E", "F", "G", "H", "I", 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', "J", "K", "L", "M", "N", "O", "P", "Q", "R", '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', "S", "T", "U", "V", "W", "X", "Y", "Z", '\0', '\0', '\0', '\0', '\0', '\0', "0", "1", 
    "2", "3", "4", "5", "6", "7", "8", "9", '\0', '\0', '\0', '\0', '\0', '\0'];

const CHAR_MAP_2 = ['\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', " ", '\0', '\0', "{", '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', ".", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "-", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', "a", "b", "c", "d", "e", "f", "g", "h", "i", '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', "j", "k", "l", "m", "n", "o", "p", "q", "r", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "s", 
    "t", "u", "v", "w", "x", "y", "z", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "A", "B", "C", "D", "E", "F", "G", "H", "I", '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', "J", "K", "L", "M", "N", "O", "P", "Q", "R", '\0', '\0', "}", '\0', '\0', 
    '\0', '\0', '\0', "S", "T", "U", "V", "W", "X", "Y", "Z", '\0', '\0', '\0', '\0', '\0', '\0', "0", "1", "2", "3", 
    "4", "5", "6", "7", "8", "9", '\0', '\0', '\0', '\0', '\0', '\0'];

const CHAR_MAP_3 = ['\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', " ", '\0', '\0', '\0', '\0', '\0', '\0', "}", '\0', 
    '\0', '\0', ".", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', "-", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "a", 
    "b", "c", "d", "e", "f", "g", "h", "i", '\0', '\0', '\0', '\0', '\0', '\0', '\0', "j", "k", "l", "m", "n", "o", 
    "p", "q", "r", '\0', '\0', "{", '\0', '\0', '\0', '\0', '\0', "s", "t", "u", "v", "w", "x", "y", "z", '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', "A", "B", "C", "D", "E", "F", "G", "H", "I", '\0', '\0', '\0', '\0', '\0', '\0', '\0', "J", "K", "L", 
    "M", "N", "O", "P", "Q", "R", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "S", "T", "U", "V", "W", "X", "Y", "Z", 
    '\0', '\0', '\0', '\0', '\0', '\0', "0", "1", "2", "3", "4", "5", "6", "7", "8", "9", '\0', '\0', '\0', '\0', '\0', '\0'];

const CHAR_MAP_4 = ['\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', " ", '\0', '\0', "{", '\0', '\0', '\0', "}", '\0', '\0', 
    '\0', ".", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', "-", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "a", "b", "c", 
    "d", "e", "f", "g", "h", "i", '\0', '\0', '\0', '\0', '\0', '\0', '\0', "j", "k", "l", "m", "n", "o", "p", "q", "r", 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "s", "t", "u", "v", "w", "x", "y", "z", '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "A", "B", 
    "C", "D", "E", "F", "G", "H", "I", '\0', '\0', '\0', '\0', '\0', '\0', '\0', "J", "K", "L", "M", "N", "O", "P", "Q", 
    "R", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "S", "T", "U", "V", "W", "X", "Y", "Z", '\0', '\0', '\0', '\0', 
    '\0', '\0', "0", "1", "2", "3", "4", "5", "6", "7", "8", "9", '\0', '\0', '\0', '\0', '\0', '\0'];

const CHAR_MAP_5 = ['\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', " ", '\0', '\0', '\0', "{", '\0', 
    '\0', '\0', '\0', '\0', '\0', ".", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "}", '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "-", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', "a", "b", "c", "d", "e", "f", "g", "h", "i", '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', "j", "k", "l", "m", "n", "o", "p", "q", "r", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "s", "t", 
    "u", "v", "w", "x", "y", "z", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "A", "B", "C", "D", "E", "F", "G", "H", "I", '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', "J", "K", "L", "M", "N", "O", "P", "Q", "R", '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', "S", "T", "U", "V", "W", "X", "Y", "Z", '\0', '\0', '\0', '\0', '\0', '\0', "0", "1", "2", 
    "3", "4", "5", "6", "7", "8", "9", '\0', '\0', '\0', '\0', '\0', '\0'];

const CHAR_MAP_6 = ['\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', " ", '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', ".", '\0', '\0', '\0', '\0', '\0', "{", '\0', '\0', "}", '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "-", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', "a", "b", "c", "d", "e", "f", "g", "h", "i", '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', "j", "k", "l", "m", "n", "o", "p", "q", "r", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "s", "t", 
    "u", "v", "w", "x", "y", "z", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "A", "B", "C", "D", "E", "F", "G", "H", "I", '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', "J", "K", "L", "M", "N", "O", "P", "Q", "R", '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', "S", "T", "U", "V", "W", "X", "Y", "Z", '\0', '\0', '\0', '\0', '\0', '\0', "0", "1", "2", 
    "3", "4", "5", "6", "7", "8", "9", '\0', '\0', '\0', '\0', '\0', '\0'];

const CHAR_MAP_7 = ['\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', " ", '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', ".", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', "-", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    "a", "b", "c", "d", "e", "f", "g", "h", "i", '\0', '\0', '\0', '\0', "{", '\0', '\0', "j", "k", "l", "m", "n", 
    "o", "p", "q", "r", '\0', '\0', "}", '\0', '\0', '\0', '\0', '\0', "s", "t", "u", "v", "w", "x", "y", "z", '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', "A", "B", "C", "D", "E", "F", "G", "H", "I", '\0', '\0', '\0', '\0', '\0', '\0', '\0', "J", 
    "K", "L", "M", "N", "O", "P", "Q", "R", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "S", "T", "U", "V", 
    "W", "X", "Y", "Z", '\0', '\0', '\0', '\0', '\0', '\0', "0", "1", "2", "3", "4", "5", "6", "7", "8", "9", 
    '\0', '\0', '\0', '\0', '\0', '\0'];

const CHAR_MAP_8 = ['\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', " ", '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', ".", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "-", '\0', "a", "b", "c", "d", "e", "f", "g", "h", 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', "i", "j", "k", "l", "m", "n", "o", "p", '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "q", '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "r", '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "s", '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    "t", "u", "v", "w", "x", "y", "z", '\0', '\0', '\0', '\0', '\0', '\0', "{", "A", "B", "C", "D", "E", "F", 
    "G", "H", "I", '\0', '\0', '\0', '\0', '\0', '\0', "}", "J", "K", "L", "M", "N", "O", "P", "Q", "R", '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', "S", "T", "U", "V", "W", "X", "Y", "Z", '\0', '\0', '\0', '\0', 
    '\0', '\0', "0", "1", "2", "3", "4", "5", "6", "7", "8", "9", '\0', '\0', '\0', '\0', '\0', '\0'];  

const CHAR_MAP_9 = ['\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', " ", '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', "{", '\0', '\0', ".", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "-", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', "a", "b", "c", "d", "e", "f", "g", "h", "i", '\0', '\0', '\0', '\0', '\0', '\0', '\0', "j", 
    "k", "l", "m", "n", "o", "p", "q", "r", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "s", "t", "u", "v", "w", 
    "x", "y", "z", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "}", '\0', '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', '\0', '\0', '\0', '\0', '\0', "A", "B", "C", "D", "E", "F", "G", "H", "I", '\0', '\0', '\0', '\0', '\0', '\0', 
    '\0', "J", "K", "L", "M", "N", "O", "P", "Q", "R", '\0', '\0', '\0', '\0', '\0', '\0', '\0', '\0', "S", "T", "U", 
    "V", "W", "X", "Y", "Z", '\0', '\0', '\0', '\0', '\0', '\0', "0", "1", "2", "3", "4", "5", "6", "7", "8", "9", 
    '\0', '\0', '\0', '\0', '\0', '\0'];

const CODE_PAGE_TO_CHAR_MAP: Record<number,string[]> = {
    37: CHAR_MAP_0,
    500: CHAR_MAP_0,
    870: CHAR_MAP_0,
    875: CHAR_MAP_0,
    1026: CHAR_MAP_1,
    1047: CHAR_MAP_0,
    1140: CHAR_MAP_0,
    1141: CHAR_MAP_2,
    1142: CHAR_MAP_3,
    1143: CHAR_MAP_4,
    1144: CHAR_MAP_5,
    1145: CHAR_MAP_0,
    1146: CHAR_MAP_0,
    1147: CHAR_MAP_6,
    1148: CHAR_MAP_0,
    1149: CHAR_MAP_7,
    20273: CHAR_MAP_2,
    20277: CHAR_MAP_3,
    20278: CHAR_MAP_4,
    20280: CHAR_MAP_5,
    20284: CHAR_MAP_0,
    20285: CHAR_MAP_0,
    20290: CHAR_MAP_8,
    20297: CHAR_MAP_6,
    20424: CHAR_MAP_0,
    20833: CHAR_MAP_0,
    20838: CHAR_MAP_0,
    20871: CHAR_MAP_7,
    20880: CHAR_MAP_0,
    20905: CHAR_MAP_9,
    20924: CHAR_MAP_0,
    21025: CHAR_MAP_0,
    21027: CHAR_MAP_0
};


function latinBytesEncodedToString(array: Uint8Array): string {
    const result = Array.from(array)
        .map(a => String.fromCharCode(a))
        .join('');
    return result;
}

function utf8BytesToString(array: Uint8Array): string {
    const encoded = Array.from(array)
        .map(a =>  "%" + ("0" + a.toString(16)).slice(-2))
        .join('');
        const result = decodeURIComponent(encoded);
        return result;
}

function convertableToLatinBytesEncodedToString(array: Uint8Array, codePage: number): string {
    const char_mapper = CODE_PAGE_TO_CHAR_MAP[codePage];
    const result = Array.from(array)
        .map(a => char_mapper[a])
        .join('');
    return result;
}

export function textDecode(array: ArrayBuffer|undefined, codePage: number): string {
    if(!array){
        return '';
    }
    const view = new Uint8Array(array);
    if(UTF8_CODE_PAGES.some(c => c===codePage)){
        return utf8BytesToString(view);
    }
    if(LATIN_BYTE_CODE_PAGES.some(c => c===codePage)){
        return latinBytesEncodedToString(view);
    }
    if(CONVERTABLE_TO_LATIN_BYTE_CODE_PAGES.some(c => c===codePage)){
        return convertableToLatinBytesEncodedToString(view, codePage);
    }
    Logger.error('Unknown file encoding');
}